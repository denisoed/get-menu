# Tasks

**Context:** Быстрое редактирование блюд через плавающую кнопку, модальное окно с вводом инструкции, подтверждение AI-изменений и пакетное обновление меню.

## Main directions
### UI
- [ ] Добавить на страницу редактирования меню плавающую кнопку с иконкой карандаша и адаптивным позиционированием.
- [ ] Реализовать модальное окно с textarea, подсказками по формату запроса, кнопками отправки и отмены, обработкой закрытия.
- [ ] Создать экран подтверждения изменений с таблицей/списком блюд, возможностью отклонения пунктов и отображением статусов.
- [ ] Интегрировать уведомления об ошибках и успехе (toast/alert) во все состояния пользовательского сценария.

### Frontend logic
- [ ] Написать композицию `useMenuQuickEdit` для управления состоянием модального окна, API-запросами, обработкой загрузки и ошибок.
- [ ] Добавить клиентские валидаторы: проверка пустого ввода, ограничение длины текста, повторная отправка по кнопке.
- [ ] Обеспечить локализацию всех новых текстов на русском, добавить поддержку тёмной темы.

### Backend / API
- [ ] Создать маршрут `app/server/api/menu/ai-diff.post.ts` с вызовом AI, нормализацией ответа и обработкой таймаута.
- [ ] Создать маршрут `app/server/api/menu/apply-diff.post.ts` с валидацией payload, проверкой прав администратора и пакетным обновлением Supabase.
- [ ] Реализовать аудит запросов: сохранять исходный текст, набор изменений, статус обработки.

### AI интеграция
- [ ] Подготовить промпт-шаблон и схему JSON-ответа для AI, учесть частые запросы администраторов.
- [ ] Добавить маппинг названий блюд на идентификаторы с обработкой неоднозначностей и предупреждениями пользователю.
- [ ] Реализовать ограничение частоты запросов и обработку ошибок AI (network, rate limit, неверный формат).

## Supporting tasks
- [ ] Документация: обновить руководство администратора по редактированию меню и описание API.
- [ ] Observability: настроить логирование и алерты по сбоям AI/применения изменений.
- [ ] Code review and PR: подготовить pull request с описанием сценария и инструкциями по тестированию.

## Definition of Done
- [ ] Все задачи выполнены и протестированы.
- [ ] Пройдены соответствующие unit/e2e/integration тесты.
- [ ] Обновлена документация и инструкции по эксплуатации.
- [ ] Выполнен `/spec/core/verify.md` после завершения задач.
