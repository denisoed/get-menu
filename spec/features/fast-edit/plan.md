# Implementation Plan

**Plan:** Реализовать сценарий быстрого редактирования блюд через плавающую кнопку, модальное окно с текстовым вводом, обработку текста AI и экран подтверждения изменений перед сохранением.

## Data sources / schemas
- Использовать существующее хранилище блюд (Supabase таблицы) с полями цены, статуса наличия, описания; подготовить серверную функцию, принимающую пакет обновлений и применяющую их в транзакции.
- Описать JSON-структуру ответа AI: идентификатор блюда, человекочитаемое название, перечень изменяемых полей с новыми значениями и комментарий модели.
- Добавить логирование запросов: сохранять исходный текст, сгенерированные изменения и статус применения в отдельной таблице аудита.

## Contracts and interfaces
- UI: плавающая кнопка `QuickEditFab`, модальный компонент `QuickEditModal` с textarea, кнопками "Отправить" и "Отмена", состоянием загрузки.
- API: POST `/api/menu/ai-diff` (внутренний маршрут) принимает текст запроса, возвращает структуру изменений и подсказки по нераспознанным пунктам; POST `/api/menu/apply-diff` принимает подтверждённый список изменений.
- Интеграция с AI: серверный обработчик вызывает AI-модель (например, OpenAI) с промптом-шаблоном и лимитом времени, обрабатывает ошибки и возвращает нормализованный JSON.
- Экран подтверждения: компонент отображает список изменений (таблица/список), позволяет редактировать/отклонять отдельные элементы перед отправкой.

## Architecture / Components
- Frontend: добавить в страницу редактирования меню (например, `app/pages/menu/edit.vue`) новую FAB-кнопку, подключающую модальное окно через состояние `useState`/`ref` и композиции.
- Создать композицию `useMenuQuickEdit` для управления состоянием модального окна, запросами к API, обработкой ошибок, отображением спиннеров и повторной отправкой.
- Backend: в `app/server/api/menu/ai-diff.post.ts` реализовать вызов AI и нормализацию, в `app/server/api/menu/apply-diff.post.ts` — валидацию payload и пакетное обновление Supabase через серверный SDK.
- Реализовать middleware/guard, проверяющий права администратора перед доступом к API.
- Добавить системы оповещения UI (toast/alert) при успехе, ошибках AI и отказе в правах.

## Risks
- AI может неправильно интерпретировать инструкции → предусмотреть ручное редактирование/удаление пунктов перед подтверждением и понятные ошибки.
- Ограничения скорости и стоимости AI-запросов → кэшировать последние запросы, добавить ограничение частоты.
- Потеря связи при применении изменений → реализовать повторный запрос и блокировку кнопки "Подтвердить" до завершения операции.
- Возможные расхождения наименований блюд → предусмотреть fuzzy-match и подсказки, чтобы администратор подтвердил соответствие.

## Assumptions
- Страница редактирования меню уже использует композицию данных блюд и авторизацию; интеграция FAB не нарушит текущую верстку.
- Для backend доступен API-ключ AI и инфраструктура хранения секретов.
- Команда согласна с требованием сохранять историю запросов для аудита.
