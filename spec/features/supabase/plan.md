# Implementation Plan

**Plan:** Реализовать серверную интеграцию с Supabase для получения списка меню, настроить переменные окружения и подготовить серверный API-эндпоинт без подключения к UI.

## Data sources / schemas
- Определить название таблицы меню в Supabase (например, `menus`) и ключевые поля (`id`, `title`, `description`, `price`, `is_active`, `position`).
- Убедиться, что таблица содержит индексы для сортировки по `position` или `created_at`, если требуется упорядочивание.
- Настроить `.env` и `.env.example` с переменными `SUPABASE_URL` и `SUPABASE_SERVICE_ROLE_KEY`; в Nuxt использовать префикс `NUXT_SUPABASE_SERVICE_ROLE_KEY` с опцией `server`.
- При необходимости добавить типы (через `types/supabase.ts` или генерацию) для строк меню, чтобы обеспечить типобезопасность при работе с SDK.

## Contracts and interfaces
- Создать серверный эндпоинт `server/api/admin/menu.get.ts` (Nuxt Nitro) или аналогичный путь, который возвращает JSON:
  ```json
  { "menus": MenuItem[], "error": null }
  ```
  либо при ошибке `{ "menus": [], "error": { "message": string } }`.
- Определить интерфейс `MenuItem` с полями, получаемыми из Supabase.
- Обрабатывать ошибки SDK: таймауты, отсутствие данных, ошибки авторизации; возвращать HTTP-код 500 или 400 с описанием без утечки деталей.
- Задокументировать формат ответа в JSDoc/комментариях для дальнейшего использования UI.

## Architecture / Components
- Использовать `@supabase/supabase-js` с инициализацией в серверном контексте (например, `server/utils/supabaseClient.ts`).
- Создать модуль-обёртку для Supabase клиента, который читает переменные окружения и кэширует экземпляр для повторного использования.
- Эндпоинт обращается к обёртке, выполняет запрос `supabase.from('menus').select('*').eq('is_active', true).order('position')` (уточнить фильтры).
- Добавить базовую обработку логов через существующий logger или `console.error` (если нет централизованного логирования).
- Убедиться, что код выполняется только на сервере, используя Nitro runtime и отсутствие экспорта в клиентский бандл.

## Risks
- Неверная конфигурация переменных окружения может привести к утечке ключа или отказу в доступе.
- При отсутствии таблицы или несовпадении схемы запрос завершится ошибкой; нужно предусмотреть fallback-ответ.
- Возможные ограничения по скорости запросов или превышение лимитов Supabase.
- Неучтённые типы данных могут привести к ошибкам сериализации на сервере.

## Assumptions
- Команда готова предоставить точное имя таблицы и поля перед реализацией.
- Существующие линтеры и проверки CI будут использоваться без дополнительной настройки.
- Нет необходимости в кешировании или пагинации на первом этапе.
- Авторизация для `/admin` будет реализована позже; текущий эндпоинт считается защищённым на уровне инфраструктуры.
